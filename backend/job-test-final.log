
> backend@1.0.0 test
> cross-env NODE_ENV=test NODE_OPTIONS=--experimental-vm-modules jest --runInBand jobs.test.js

  console.log
    [dotenv@17.2.3] injecting env (8) from .env.test -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    â­  Skipping DB connection in test mode

      at log (config/db.js:8:13)

(node:21656) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    âœ… Test database connected

      at Object.log (__tests__/setup.js:17:13)

  console.error
    ERROR ValidationError: Validation failed: description: Path `description` (`Updated description`, length 19) is shorter than the minimum allowed length (20).
        at updateValidators (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\helpers\updateValidators.js:186:17)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at model.Query.validate (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\query.js:4130:5)
        at model.Query._findOneAndUpdate (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\query.js:3540:5)
        at model.Query.exec (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\query.js:4637:63)
        at C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\controllers\jobController.js:105:22 {
      errors: {
        description: ValidatorError: Path `description` (`Updated description`, length 19) is shorter than the minimum allowed length (20).
            at SchemaString.doValidate (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\schemaType.js:1425:13)
            at updateValidators (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\helpers\updateValidators.js:137:22)
            at model.Query.validate (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\query.js:4130:11)
            at processTicksAndRejections (node:internal/process/task_queues:105:5)
            at model.Query._findOneAndUpdate (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\query.js:3540:5)
            at model.Query.exec (C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\node_modules\mongoose\lib\query.js:4637:63)
            at C:\Users\Vaibhav\Desktop\My Projects\hirenest\backend\controllers\jobController.js:105:22 {
          properties: [Object],
          kind: 'minlength',
          path: 'description',
          value: 'Updated description',
          reason: undefined,
          [Symbol(mongoose#validatorError)]: true
        }
      },
      _message: 'Validation failed',
      statusCode: 500,
      status: 'error'
    }

    [0m [90m 19 |[39m       })[33m;[39m
     [90m 20 |[39m     } [36melse[39m {
    [31m[1m>[22m[39m[90m 21 |[39m       console[33m.[39merror([32m"ERROR"[39m[33m,[39m err)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 22 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 23 |[39m         status[33m:[39m [32m"error"[39m[33m,[39m
     [90m 24 |[39m         message[33m:[39m [32m"Something went wrong!"[39m[33m,[39m[0m

      at error (middleware/errorHandler.js:21:15)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)

  console.log
    âœ… Test database disconnected

      at Object.log (__tests__/setup.js:39:11)

FAIL __tests__/jobs.test.js (14.365 s)
  Job API
    POST /api/jobs
      âˆš should create a job by employer with company (1245 ms)
      âˆš should reject job creation by jobseeker (696 ms)
      Ã— should reject job creation without company (444 ms)
    GET /api/jobs
      âˆš should get all active jobs (881 ms)
      âˆš should filter jobs by location (717 ms)
      âˆš should filter jobs by job type (714 ms)
    GET /api/jobs/:id
      âˆš should get single job by ID (641 ms)
      âˆš should return 404 for non-existent job (381 ms)
    PUT /api/jobs/:id
      Ã— should update own job (969 ms)
      âˆš should reject update of other user's job (1180 ms)
    DELETE /api/jobs/:id
      âˆš should delete own job (soft delete) (1076 ms)
      âˆš should reject deletion of other user's job (1283 ms)
    PATCH /api/jobs/:id/close
      âˆš should close/reopen job (879 ms)
      âˆš should reject closing already closed job (889 ms)

  â— Job API â€º POST /api/jobs â€º should reject job creation without company

    TypeError: expect(received).toMatch(expected)

    Matcher error: received value must be a string

    Received has value: undefined

    [0m [90m 73 |[39m
     [90m 74 |[39m       expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 75 |[39m       expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/company profile first/i[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 76 |[39m     })[33m;[39m
     [90m 77 |[39m   })[33m;[39m
     [90m 78 |[39m[0m

      at Object.toMatch (__tests__/jobs.test.js:75:32)

  â— Job API â€º PUT /api/jobs/:id â€º should update own job

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 167 |[39m         [33m.[39msend(updates)[33m;[39m
     [90m 168 |[39m
    [31m[1m>[22m[39m[90m 169 |[39m       expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 170 |[39m       expect(res[33m.[39mbody[33m.[39mtitle)[33m.[39mtoBe(updates[33m.[39mtitle)[33m;[39m
     [90m 171 |[39m       expect(res[33m.[39mbody[33m.[39mdescription)[33m.[39mtoBe(updates[33m.[39mdescription)[33m;[39m
     [90m 172 |[39m     })[33m;[39m[0m

      at Object.toBe (__tests__/jobs.test.js:169:30)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 12 passed, 14 total
Snapshots:   0 total
Time:        14.459 s, estimated 16 s
Ran all test suites matching jobs.test.js.
