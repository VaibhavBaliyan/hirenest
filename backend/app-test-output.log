
> backend@1.0.0 test
> cross-env NODE_ENV=test NODE_OPTIONS=--experimental-vm-modules jest --runInBand applications.test.js

  console.log
    [dotenv@17.2.3] injecting env (8) from .env.test -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    â­  Skipping DB connection in test mode

      at log (config/db.js:8:13)

(node:19736) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    âœ… Test database connected

      at Object.log (__tests__/setup.js:17:13)

  console.log
    âœ… Test database disconnected

      at Object.log (__tests__/setup.js:39:11)

FAIL __tests__/applications.test.js (15.229 s)
  Application API
    POST /api/applications/:id/apply
      âˆš should submit job application with resume (1842 ms)
      âˆš should reject duplicate application (1532 ms)
      âˆš should reject application without resume (1078 ms)
      âˆš should reject application to closed job (1091 ms)
      Ã— should reject employer applying to own job (799 ms)
    GET /api/applications/my-applications
      Ã— should get jobseeker's applications (1100 ms)
    GET /api/applications/job/:id
      âˆš should get job applicants (employer only) (2127 ms)
      âˆš should reject non-owner from viewing applicants (863 ms)
    PATCH /api/applications/:id/status
      âˆš should update application status (employer only) (1386 ms)
      Ã— should reject invalid status (1277 ms)

  â— Application API â€º POST /api/applications/:id/apply â€º should reject employer applying to own job

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 403

    [0m [90m 107 |[39m         [33m.[39msend({ coverLetter[33m:[39m [32m"Applying to own job"[39m })[33m;[39m
     [90m 108 |[39m
    [31m[1m>[22m[39m[90m 109 |[39m       expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m400[39m)[33m;[39m
     [90m     |[39m                              [31m[1m^[22m[39m
     [90m 110 |[39m       expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/your own job/i[39m)[33m;[39m
     [90m 111 |[39m     })[33m;[39m
     [90m 112 |[39m   })[33m;[39m[0m

      at Object.toBe (__tests__/applications.test.js:109:30)

  â— Application API â€º GET /api/applications/my-applications â€º should get jobseeker's applications

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 0

    [0m [90m 144 |[39m       expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 145 |[39m       expect([33mArray[39m[33m.[39misArray(res[33m.[39mbody))[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 146 |[39m       expect(res[33m.[39mbody[33m.[39mlength)[33m.[39mtoBe([35m2[39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 147 |[39m       expect(res[33m.[39mbody[[35m0[39m][33m.[39mjobId)[33m.[39mtoBeDefined()[33m;[39m
     [90m 148 |[39m     })[33m;[39m
     [90m 149 |[39m   })[33m;[39m[0m

      at Object.toBe (__tests__/applications.test.js:146:31)

  â— Application API â€º PATCH /api/applications/:id/status â€º should reject invalid status

    TypeError: expect(received).toMatch(expected)

    Matcher error: received value must be a string

    Received has value: undefined

    [0m [90m 275 |[39m
     [90m 276 |[39m       expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m400[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 277 |[39m       expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/invalid status/i[39m)[33m;[39m
     [90m     |[39m                                [31m[1m^[22m[39m
     [90m 278 |[39m     })[33m;[39m
     [90m 279 |[39m   })[33m;[39m
     [90m 280 |[39m })[33m;[39m[0m

      at Object.toMatch (__tests__/applications.test.js:277:32)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 7 passed, 10 total
Snapshots:   0 total
Time:        15.293 s
Ran all test suites matching applications.test.js.
